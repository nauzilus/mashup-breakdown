{"version":3,"sources":["util/clamp.ts","hooks/usePlayer.ts","util/secondsToTime.ts","MashupBreakdown.tsx","App.tsx","index.tsx"],"names":["clamp","min","max","val","getSeek","state","duration","playing","seek","Date","now","ts","reducer","action","type","payload","secondsToTime","seconds","long","floored","Math","floor","s","m","h","concat","map","x","substr","join","Layout","styled","div","MashupBreakdown","data","tracks","useMemo","reduce","out","track","last","slice","length","samples","end","start","push","title","flatMap","sample","offset","idx","useState","setDuration","zoom","player","initialSeek","useReducer","dispatch","useEffect","play","useCallback","pause","toggle","update","currentSeek","usePlayer","onProgress","playedSeconds","id","setInterval","clearInterval","windowStart","windowEnd","lowResStart","lowResEnd","inViewTracks","filter","inViewSamples","url","width","height","onReady","rp","getDuration","onPlay","onPause","onSeek","onEnded","className","active","style","marginLeft","Boolean","left","right","artist","marginRight","target","href","encodeURIComponent","onClick","source","App","allDay","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.e5e70d92.chunk.js","sourcesContent":["export function clamp(min: number, max: number, val: number): number {\n  return val < min ? min : val > max ? max : val;\n}\n","import { Reducer, useCallback, useEffect, useMemo, useReducer } from \"react\";\nimport { clamp } from \"../util/clamp\";\n\ninterface PlayerState {\n  playing: boolean;\n  duration: number;\n  seek: number;\n  ts: number;\n}\n\ninterface Action<T extends string> {\n  type: T;\n  ts: number;\n}\ninterface ActionWithPayload<T extends string, TPayload> extends Action<T> {\n  payload: TPayload;\n}\n\ntype PlayAction = Action<\"play\">;\ntype PauseAction = Action<\"pause\">;\ntype ToggleAction = Action<\"toggle\">;\ntype UpdateAction = Action<\"update\">;\ntype SeekAction = ActionWithPayload<\"seek\", number>;\ntype InitAction = ActionWithPayload<\"init\", number>;\ntype PlayerAction =\n  | PlayAction\n  | PauseAction\n  | ToggleAction\n  | UpdateAction\n  | InitAction\n  | SeekAction;\n\nfunction getSeek(state: PlayerState): number {\n  return clamp(\n    0,\n    state.duration,\n    state.playing ? state.seek + (Date.now() - state.ts) / 1000 : state.seek\n  );\n}\n\nfunction reducer(state: PlayerState, action: PlayerAction): PlayerState {\n  const switchAction: PlayerAction = (() => {\n    if (action.type === \"toggle\") {\n      return state.playing\n        ? ({ type: \"pause\" } as PauseAction)\n        : ({ type: \"play\" } as PlayAction);\n    }\n    return action;\n  })();\n\n  switch (switchAction.type) {\n    case \"play\": {\n      return {\n        ...state,\n        playing: true,\n        ts: action.ts,\n      };\n    }\n    case \"pause\": {\n      return {\n        ...state,\n        playing: false,\n        seek: getSeek(state),\n        ts: action.ts,\n      };\n    }\n    case \"update\": {\n      if (state.playing) {\n        const playing = getSeek(state) < state.duration;\n        return {\n          ...state,\n          playing,\n          ...(!playing && {\n            seek: getSeek(state),\n            ts: action.ts,\n          }),\n        };\n      }\n      return state;\n    }\n    case \"init\": {\n      return {\n        duration: (action as InitAction).payload,\n        seek: 0,\n        playing: false,\n        ts: action.ts,\n      };\n    }\n    case \"seek\": {\n      return {\n        ...state,\n        seek: (action as SeekAction).payload,\n        ts: action.ts,\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nexport interface UsePlayerApi {\n  playing: boolean;\n  play: () => void;\n  pause: () => void;\n  toggle: () => void;\n  update: () => void;\n  seek: (seconds: number) => void;\n  currentSeek: () => number;\n}\n\nexport function usePlayer(\n  duration: number,\n  initialSeek = 0,\n  playing = false\n): UsePlayerApi {\n  const [state, dispatch] = useReducer<Reducer<PlayerState, PlayerAction>>(\n    reducer,\n    {\n      playing,\n      duration,\n      seek: initialSeek,\n      ts: Date.now(),\n    }\n  );\n\n  useEffect(() => {\n    dispatch({ type: \"init\", ts: Date.now(), payload: duration });\n  }, [duration]);\n\n  const play = useCallback(\n    () => dispatch({ type: \"play\", ts: Date.now() }),\n    []\n  );\n  const pause = useCallback(\n    () => dispatch({ type: \"pause\", ts: Date.now() }),\n    []\n  );\n  const toggle = useCallback(\n    () => dispatch({ type: \"toggle\", ts: Date.now() }),\n    []\n  );\n  const update = useCallback(\n    () => dispatch({ type: \"update\", ts: Date.now() }),\n    []\n  );\n  const seek = useCallback(\n    (seconds: number) =>\n      dispatch({ type: \"seek\", ts: Date.now(), payload: seconds }),\n    []\n  );\n  const currentSeek = useCallback(() => getSeek(state), [state]);\n\n  return useMemo(\n    () => ({\n      play,\n      pause,\n      toggle,\n      update,\n      seek,\n      currentSeek,\n      playing: state.playing,\n    }),\n    [play, pause, toggle, update, seek, currentSeek, state]\n  );\n}\n","export function secondsToTime(seconds: number, long: boolean = false): string {\n  const floored = Math.floor(seconds);\n  const s = floored % 60;\n  const m = Math.floor(floored / 60) % 60;\n  const h = Math.floor(floored / 3600);\n\n  return (long || h > 0 ? [h] : [])\n    .concat(m, s)\n    .map((x) => `0${x}`.substr(-2))\n    .join(\":\");\n}\n","import { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { usePlayer } from \"./hooks/usePlayer\";\nimport { clamp } from \"./util/clamp\";\nimport { secondsToTime } from \"./util/secondsToTime\";\nimport ReactPlayer from \"react-player\";\nimport styled from \"styled-components\";\n\nexport interface Sample {\n  start: number;\n  end: number;\n  artist: string;\n  title: string;\n}\n\nexport interface Track {\n  title: string;\n  offset: number;\n  samples: Sample[];\n}\n\nexport interface Mashup {\n  artist: string;\n  title: string;\n  url: string;\n  source: string;\n  tracks: Track[];\n}\n\nexport interface MashupBreakdownProps {\n  data: Mashup;\n}\n\nconst Layout = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  > main {\n    flex-grow: 1;\n    background-color: ghostwhite;\n  }\n  > footer {\n    display: flex;\n    justify-content: center;\n    padding: 1em 0;\n    font-size: 0.8em;\n    border-top: 1px solid;\n    border-color: lightgray;\n    background-color: crimson;\n    color: white;\n    a {\n      color: white;\n      margin: 0 0.5em;\n    }\n  }\n`;\n\nexport function MashupBreakdown({ data }: MashupBreakdownProps) {\n  const tracks = useMemo(() => {\n    return data.tracks.reduce<\n      Array<{ title: string; start: number; end: number; length: number }>\n    >((out, track) => {\n      const last = out.slice(-1)[0];\n      const length = Math.max(...track.samples.map((x) => x.end));\n      const start = last ? last.end : 0;\n      const end = start + length;\n      out.push({\n        title: track.title,\n        start,\n        end,\n        length,\n      });\n      return out;\n    }, []);\n  }, [data]);\n\n  const samples = useMemo<Array<Sample & { idx: number }>>(() => {\n    return data.tracks\n      .flatMap((track) => {\n        return track.samples.map((sample) => ({\n          ...sample,\n          start: track.offset + sample.start,\n          end: track.offset + sample.end,\n        }));\n      })\n      .map((sample, idx) => ({ ...sample, idx }));\n  }, [data]);\n\n  const [duration, setDuration] = useState(0);\n  const [zoom] = useState(30); // seconds to show in the sliding window\n  const player = usePlayer(duration);\n  const seek = player.currentSeek();\n\n  const onProgress = useCallback(\n    (data: { playedSeconds: number }) => {\n      player.seek(data.playedSeconds);\n    },\n    [player.seek]\n  );\n\n  useEffect(() => {\n    if (player.playing) {\n      const id = setInterval(player.update, 100);\n      return () => {\n        clearInterval(id);\n      };\n    }\n  }, [player.playing, player.update]);\n\n  const windowStart = seek - zoom / 2;\n  const windowEnd = seek + zoom / 2;\n  const lowResStart = Math.floor(windowStart);\n  const lowResEnd = Math.floor(windowEnd);\n\n  const inViewTracks = useMemo(() => {\n    return tracks.filter(\n      (track) =>\n        (track.start <= lowResEnd && track.end >= lowResStart) ||\n        (track.end >= lowResStart && track.start <= lowResEnd)\n    );\n  }, [tracks, lowResStart, lowResEnd]);\n\n  const inViewSamples = useMemo(() => {\n    return samples.filter(\n      (sample) =>\n        (sample.start <= lowResEnd && sample.end >= lowResStart) ||\n        (sample.end >= lowResStart && sample.start <= lowResEnd)\n    );\n  }, [samples, lowResStart, lowResEnd]);\n\n  return (\n    <Layout>\n      <ReactPlayer\n        playing={player.playing}\n        url={data.url}\n        width=\"100%\"\n        height=\"200px\"\n        onReady={(rp) => setDuration(rp.getDuration())}\n        onPlay={player.play}\n        onPause={player.pause}\n        onProgress={onProgress}\n        onSeek={player.seek}\n        onEnded={player.pause}\n      />\n      {duration > 0 && (\n        <>\n          <main className=\"seek-window\">\n            <div className=\"seek-tracks\">\n              {inViewTracks.map((track) => {\n                const active = track.start <= seek && track.end >= seek;\n                const start = Math.max(windowStart, track.start);\n                const end = Math.min(windowEnd, track.end);\n                const width = clamp(0, 100, ((end - start) / zoom) * 100);\n                const offset =\n                  windowStart < 0 ? (-windowStart / zoom) * 100 : 0;\n\n                return (\n                  <div\n                    key={track.title}\n                    style={{ width: `${width}%`, marginLeft: `${offset}%` }}\n                    className={[\"sample track\", active && \"active\"]\n                      .filter(Boolean)\n                      .join(\" \")}\n                  >\n                    <div className=\"description\">{track.title}</div>\n                  </div>\n                );\n              })}\n            </div>\n            <div className=\"seek-samples\">\n              {inViewSamples.map((sample) => {\n                const active = sample.start <= seek && sample.end >= seek;\n                const left =\n                  sample.start <= windowStart\n                    ? 0\n                    : clamp(\n                        0,\n                        100,\n                        ((sample.start - windowStart) / zoom) * 100\n                      );\n\n                const right =\n                  sample.end >= windowEnd\n                    ? 0\n                    : clamp(0, 100, ((windowEnd - sample.end) / zoom) * 100);\n\n                const title = `${sample.artist}, ${sample.title}`;\n                return (\n                  <div\n                    key={sample.idx}\n                    style={{ marginLeft: `${left}%`, marginRight: `${right}%` }}\n                    className={[\"sample\", active && \"active\"]\n                      .filter(Boolean)\n                      .join(\" \")}\n                  >\n                    <div className=\"description\">\n                      <a\n                        target=\"_blank\"\n                        href={`http://www.google.com/search?btnI&q=${encodeURIComponent(\n                          `site:youtube.com ${title}`\n                        )}`}\n                        onClick={() => player.pause()}\n                      >\n                        {title}\n                      </a>\n                      <br />\n                      <small>\n                        {secondsToTime(sample.start)}&mdash;\n                        {secondsToTime(sample.end)}\n                      </small>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </main>\n          <footer>\n            sauce:\n            <a href={data.source} target=\"_blank\">\n              timings\n            </a>\n            <a href=\"https://favicon.io/\" target=\"_blank\">\n              favicon\n            </a>\n          </footer>\n        </>\n      )}\n    </Layout>\n  );\n}\n","import React from \"react\";\nimport allDay from \"./data/girl-talk_all-day.json\";\nimport feedTheAnimals from \"./data/girl-talk_feed-the-animals.json\";\nimport nightRipper from \"./data/girl-talk_night-ripper.json\";\nimport { MashupBreakdown } from \"./MashupBreakdown\";\n\nfunction App() {\n  return <MashupBreakdown data={allDay} />;\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./App.css\";\n// import reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\n// reportWebVitals(console.debug);\n"],"sourceRoot":""}